syntax = "proto3";

package can;

option go_package = "./protofiles";

// Define the CAN Node Service
service CANNode {
  // Join the CAN network
  rpc Join(JoinRequest) returns (JoinResponse);

  // Lookup a key in the CAN network
  rpc Lookup(LookupRequest) returns (LookupResponse);

  // Store a key-value pair in the CAN network
  rpc Store(StoreRequest) returns (StoreResponse);
}


// meta types Zone and Node
message Zone {
  repeated float minCoordinates = 1; // coordinates of the zone (d)
  repeated float maxCoordinates = 2; // coordinates of the zone (d)
}
message Node {
  string node_id = 1; // Unique identifier for the node
  string address = 2; // IP:Port of the node
  Zone zone = 3; // The zone assigned to the node
}


// Request for joining the CAN network
message JoinRequest {
  // coordinates of the zone to be split - should be exactly d floats
  repeated float coordinates = 1;
  Node node = 2; // The node that is joining the network
}

message JoinResponse {
  Zone assigned_zone = 1; // The zone assigned to the node
  repeated Node neighbors = 2; // List of neighboring nodes (2*d)
}

// Request for looking up a key
message LookupRequest {
  string key = 1;
}
message LookupResponse {
  string value = 1;
}

// Request for storing a key-value pair
message StoreRequest {
  string key = 1;
  string value = 2;
}

message StoreResponse {
  bool success = 1;
}

// Empty message (used for requests with no parameters)
message Empty {}

// Response containing a list of neighbors
message NeighborList {
  repeated Neighbor neighbors = 1;
}

// Represents a neighboring node
message Neighbor {
  string node_id = 1;
  string address = 2;
  string zone = 3; // Example: "x_min,y_min,x_max,y_max"
}
